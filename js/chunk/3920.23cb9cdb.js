"use strict";(self.webpackChunkbalm_ui=self.webpackChunkbalm_ui||[]).push([[3920],{23920:function(e,t,o){o.d(t,{Z:function(){return te}});var n=o(73114);let l,i,r={};const s=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object.keys(e).length&&(e.quill?i=e.quill:(l=e.Quill,r=e.toolbarHandlers))},a=()=>({Quill:l,quill:i,toolbarHandlers:r}),c="ql-emoji";function d(e,t){return t.name&&("emoji"===e?t.value:t.src)}function u(e){return"emoji"===e.type?`:${e.name}:`:`[${e.name}]`}function m(e){let t,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=function(e,t){let o=t;return t||(o="emoji"===e.type?document.createElement("span"):document.createElement("img")),"emoji"===e.type?(o.innerHTML=e.value,o.style.fontSize="18px"):(o.src=e.src,o.setAttribute("alt",e.alt||"")),o}(e,o);return o||(t=document.createElement("span"),t.classList.add(c,`ql-${e.type}-${e.name}`),t.appendChild(n)),o?n:t}const p=/(:\w+:)|(\[\w+\])/g;let f=[],h={},b={};var g=class{constructor(e){for(let t=0,o=e.length;t<o;t++){const o=e[t];if(f.push({type:o.type,title:o.title}),!o.content.every((e=>d(o.type,e)))){console.warn("[UiEditor]","Invalid emotions format"),f=[],h={},b={};break}{let e=[];[].slice.call(o.content).forEach((t=>{const n=Object.assign({type:o.type},t),l=u(n);e.push(n),b[l]=n})),h[o.title]=e}}}static getTypes(){return f}static getEmotion(e){return h[e]}static getEmotions(){return b}static clear(){f=[],h={},b={}}static encode(e){const t=(new DOMParser).parseFromString(e,"text/html");return t.querySelectorAll(`.${c}`).forEach((e=>{const t=e.classList[1]?e.classList[1].split("-"):[];if(3===t.length){!function(e,t){if(e.outerHTML)e.outerHTML=t;else{let o=document.createElement("div");o.innerText=t;let n=e.parentNode;n.replaceChild(o,e),n.innerHTML=n.innerHTML.replace(`<div>${t}</div>`,t)}}(e,u({type:t[1],name:t[2]}))}})),t.querySelector("body").innerHTML}static decode(e){let t=e;try{const o=e.match(p);o&&o.forEach((e=>{let o="emoji"===b[e].type?document.createElement("span"):document.createElement("img");o.classList.add(c);const n=m(b[e],o);t=t.replace(e,n.outerHTML)}))}catch(o){console.warn("[UiEditor]","The param of the 'decodeEmoji' method must be an async data")}return t}};var E=function(){const{Quill:e}=a(),t=e.import("parchment");class o extends t.Embed{static create(e){let t="emoji"===e.type?document.createElement("span"):document.createElement("img");if("object"===typeof e)return m(e,t);if("string"===typeof e){return m(g.getEmotions()[e],t)}return console.warn("[UiEditor]","Invalid emoji"),t}}o.blotName="emoji",o.tagName=["SPAN","IMG"],o.className=c,e.register("formats/emoji",o,!0)},y=o(8228);const v={id:"ql-emoji-toolbar",closeId:"ql-emoji-toolbar-close",cssClasses:{tabBar:"ql-emoji-tab-bar",tabScroller:"ql-emoji-tab-scroller",tabContent:"ql-emoji-tab-content",tab:"ql-emoji-tab",tabActive:"ql-emoji-tab--active",panel:"ql-emoji-panel"}};let q=!1;function j(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"div";const o=document.createElement(t);return o.className=e,o}function _(){let e=document.getElementById(v.id);return e&&e.remove(),e}function C(e){const t=e.target;if(t&&new RegExp(`^${c}`).test(t.classList[0]))e.preventDefault(),e.stopPropagation();else if(q){let e=t;for(;e&&e.classList&&!e.classList.contains("mdc-editor-quill");)if(e=e.parentNode,e&&e.classList&&e.classList.contains("mdc-editor-quill")){e.querySelector("#ql-emoji-toolbar")||_();break}}else _()}var w=function(){const{Quill:e}=a(),t=e.import("core/module");e.register("modules/emoji",class extends t{constructor(e,t){super(e,t),this.quill=e;const o=e.getModule("toolbar");"undefined"!==typeof o&&(o.addHandler("emoji",this.openEmojiToolbar.bind(this)),this.quill.on("selection-change",((e,t,o)=>{if(q=e,q){let e=document.getElementById(v.id);e&&this.setEmojiToolbarBounds(e)}})))}setEmojiToolbarBounds(e){let t=this.quill.getSelection(!0);if(e&&t){let o=this.quill.getBounds(t.index),n=o.left+240;e.style.top=`${o.top+o.height+10}px`,n>this.quill.container.offsetWidth?e.style.left=o.left-250+"px":e.style.left=`${o.left}px`}}openEmojiToolbar(){if(!_()){const e=document.createElement("div");e.id=v.id,this.quill.container.appendChild(e),this.setEmojiToolbarBounds(e);const t=document.createElement("i");t.id=v.closeId,t.className=y.Z.cssClasses.icon,t.innerHTML="close",e.appendChild(t);const o=j(v.cssClasses.tabBar),n=j(v.cssClasses.tabScroller);o.appendChild(n),e.appendChild(o);const l=j(v.cssClasses.panel);e.appendChild(l);const i=g.getTypes();this.addTabs(i,n,l),this.updatePanel(i[0]&&i[0].title,l),this.onEmojiHandler(),this.onCloseHandler()}}addTabs(e,t,o){const n=j(v.cssClasses.tabContent,"ul");t.appendChild(n),e.forEach(((e,t)=>{let l=document.createElement("li");l.classList.add(v.cssClasses.tab),0===t&&l.classList.add(v.cssClasses.tabActive),l.innerHTML=e.title,l.dataset.title=e.title,n.appendChild(l),l.addEventListener(y.Z.EVENTS.CLICK,(e=>{let t=e.target;if(!t.classList.contains(v.cssClasses.tabActive)){let e=document.querySelector(`.${v.cssClasses.tabActive}`);e&&e.classList.remove(v.cssClasses.tabActive),t.classList.toggle(v.cssClasses.tabActive),this.updatePanel(t.dataset.title,o)}}))}))}updatePanel(e,t){if(e){t.innerHTML="",g.getEmotion(e).forEach((e=>{const o=m(e);o.setAttribute("title",u(e)),t.appendChild(o)})),this.quill.focus()}else t.innerHTML="Emotions is empty"}onEmojiHandler(){const t=g.getEmotions();document.querySelector(".ql-emoji-panel").addEventListener(y.Z.EVENTS.CLICK,(o=>{const n=o.target.parentNode;if(n&&n.classList.contains(c)){let o=this.quill.getSelection(!0);o&&(this.quill.insertEmbed(o.index,"emoji",t[n.title],e.sources.USER),this.quill.setSelection(o.index+1,e.sources.SILENT)),_()}}))}onCloseHandler(){document.getElementById(v.closeId).addEventListener(y.Z.EVENTS.CLICK,_)}},!0)};var T=function(e){g.getTypes().length||(new g(e),E(),w())};var L=function(){const{Quill:e}=a(),t=e.import("attributors/style/align");e.register(t,!0)};var S=function(){const{Quill:e}=a(),t=e.import("attributors/style/direction");e.register(t,!0)};const k="em",N=[1,2,3,4,5,6,7,8].map((e=>`${e}${k}`));var H=function(){const{Quill:e}=a(),t=e.import("parchment");let o={scope:t.Scope.BLOCK,whitelist:N};class n extends t.Attributor.Style{add(e,t){if("+1"===t||"-1"===t){let o=this.value(e)||0;t="+1"===t?o+1:o-1}return 0===t?(this.remove(e),!0):super.add(e,`${t}${k}`)}value(e){return parseInt(super.value(e))||void 0}}const l=new n("indent","margin-left",o),i=new n("textindent","text-indent",o);e.register(l,!0),e.register(i,!0)};var I=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(e.length){const{Quill:t}=a(),o=t.import("attributors/style/font");o.whitelist=e,t.register(o,!0)}};var O=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(e.length){const{Quill:t}=a(),o=t.import("attributors/style/size");o.whitelist=e,t.register(o,!0)}};var x=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(e.length){const{Quill:t}=a(),o=t.import("parchment");let n={scope:o.Scope.INLINE,whitelist:e};const l=new o.Attributor.Style("lineheight","line-height",n);t.register(l,!0)}};var A=function(){const{Quill:e}=a(),t=e.import("parchment");class o extends t.Embed{static create(e){let t=super.create();return"string"===typeof e&&(t.innerHTML=e),t}}o.blotName="html",o.tagName="DIV",e.register("formats/html",o,!0)};var B=function(e){let{font:t,size:o,lineheight:n}=e;L(),S(),H(),I(t),O(o),x(n),A()};const $=`.ql-picker${["header","font","size","lineheight"].map((e=>`:not(.ql-${e})`)).join("")} .ql-picker-label`;function R(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=document.querySelectorAll(".ql-toolbar button"),o=document.querySelectorAll(`.ql-toolbar ${$}`),n=document.querySelectorAll(".ql-toolbar .ql-align .ql-picker-item");if([...t,...o,...n].forEach((e=>{e.classList.add(y.Z.cssClasses.icon)})),Object.keys(e).length){const o=document.querySelectorAll(".ql-toolbar .ql-picker");!function(e,t){const o=Object.keys(t);e.forEach((e=>{const n=e.classList[0].replace("ql-","");o.includes(n)&&("object"===typeof t[n]?e.title=t[n][e.value||"default"]:e.title=t[n])}))}([...t,...o],e)}}var M=function(){const{Quill:e}=a();e.register("modules/counter",class{constructor(e,t){this.quill=e,this.options=t,this.container=t.container,e.on("text-change",this.update.bind(this)),this.update()}calculate(){let e=this.quill.getText();return"word"===this.options.unit?(e=e.trim(),e.length>0?e.split(/\s+/).length:0):e.length}update(){let e=this.calculate(),t=this.options.unit||"character";1!==e&&(t+="s"),this.container.innerText=e+" "+t}},!0)};var V=function(){const{toolbarHandlers:e}=a();e.undo=()=>{const{quill:e}=a();e.history.undo()},e.redo=()=>{const{quill:e}=a();e.history.redo()}};var Q=function(e){!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{Quill:t}=a(),o=t.import("ui/icons");for(const[n,l]of Object.entries(e))o[n]=l}(e),M(),V()};var P=function(){const{Quill:e}=a(),t=e.import("parchment");class o extends t.Embed{}o.blotName="divider",o.tagName="HR",e.register("formats/divider",o,!0)};var U=function(){const{Quill:e}=a();e.register("modules/divider",class{constructor(e){this.quill=e;const t=e.getModule("toolbar");"undefined"!==typeof t&&t.addHandler("divider",this.insertHandler.bind(this))}insertHandler(){let t=this.quill.getSelection(!0);t&&(this.quill.insertText(t.index,"\n",e.sources.USER),this.quill.insertEmbed(t.index+1,"divider",!0,e.sources.USER),this.quill.setSelection(t.index+2,e.sources.SILENT))}},!0)};var F=function(){P(),U()};var Z=function(){const{toolbarHandlers:e}=a();e.linkoff=()=>{const{quill:e}=a();let t=e.getContents().ops.map((e=>(e.attributes&&"undefined"!==typeof e.attributes.link&&delete e.attributes.link,e)));e.setContents(t)}};var z=function(){const{toolbarHandlers:e}=a();e.selectall=()=>{const{quill:e}=a();let t=e.getText();e.setSelection(0,t.length)}};var G=function(){F(),Z(),z()};const D=["divider","emoji"];var K=o(93590),W=o(64160),X={EVENTS:{TEXT_CHANGE:"update:modelValue",FILE_CHANGE:"file-change"},BLANK:"<p><br></p>",toolbarIcons:{align:{"":"format_align_left",center:"format_align_center",right:"format_align_right",justify:"format_align_justify"},background:"font_download",blockquote:"format_quote",bold:"format_bold",clean:"format_clear",code:"code",color:"text_format",formula:"functions",italic:"format_italic",image:"insert_photo",indent:{"+1":"format_indent_increase","-1":"format_indent_decrease"},link:"insert_link",list:{ordered:"format_list_numbered",bullet:"format_list_bulleted"},script:{sub:"subscript",super:"superscript"},strike:"strikethrough_s",underline:"format_underlined",video:"videocam",divider:"horizontal_rule",emoji:"insert_emoticon",cut:"content_cut",copy:"content_copy",paste:"content_paste",delete:"clear",search:"search",preview:"preview",selectall:"select_all",fullscreen:{"":"fullscreen",exit:"fullscreen_exit"},undo:"undo",redo:"redo",linkoff:"link_off",textindent:{"+1":"format_indent_increase","-1":"format_indent_decrease"},pdf:"picture_as_pdf"},defaultToolbar:[[{header:[]},{font:[]},{size:[]}],["bold","italic","underline",{color:[]},{background:[]}],[{align:""},{align:"center"},{align:"right"},{align:"justify"}],[{list:"ordered"},{list:"bullet"},{indent:"+1"},{indent:"-1"},"blockquote","emoji"],["link","image","video"],["strike",{script:"super"},{script:"sub"},"divider"],["clean","undo","redo"]]};const J={class:"mdc-editor__content"},Y={key:0,class:"mdc-editor-code",contenteditable:""},ee={name:"UiEditor",customOptions:{UI_EDITOR:X}};var te=Object.assign(ee,{props:{modelValue:{type:String,default:""},options:{type:Object,default:()=>({})},toolbar:{type:[Array,String,null],default:null},placeholder:{type:[String,null],default:null},readonly:{type:Boolean,default:!1},fullwidth:{type:Boolean,default:!1},theme:{type:String,default:"snow"},toolbarIcons:{type:Object,default:()=>({})},toolbarTips:{type:Object,default:()=>({})},toolbarOptions:{type:Object,default:()=>({})},toolbarHandlers:{type:Object,default:()=>({})},customImageHandler:{type:Boolean,default:!1},emotions:{type:Array,default:()=>[]},withCounter:{type:Boolean,default:!1},extension:{type:[Boolean,Object],default:!1}},emits:[X.EVENTS.TEXT_CHANGE,X.EVENTS.FILE_CHANGE],setup(e,t){let{expose:l,emit:i}=t;const r=e,c=(0,n.ref)(null),d=(0,n.ref)(null),u=(0,n.ref)(null),m=(0,n.reactive)({$editor:null,htmlContent:"",editSourceCode:!1}),{htmlContent:p,editSourceCode:f}=(0,n.toRefs)(m),h=(0,n.computed)((()=>({"mdc-editor":!0,"mdc-editor--fullwidth":r.fullwidth})));function b(e,t,o){for(let n of e)"object"===(0,W.Z)(n)&&"array"===(0,W.Z)(n[t])&&0===n[t].length?n[t]=[!1,...o]:"array"===(0,W.Z)(n)&&b(n,t,o)}function E(){let e=r.toolbar;return"array"===(0,W.Z)(e)&&Object.keys(r.toolbarOptions).forEach((t=>{r.toolbarOptions[t].length&&b(e,t,r.toolbarOptions[t])})),"full"===r.toolbar?X.defaultToolbar:e}function y(e){const{placeholder:t,readOnly:o,theme:n}=r,l={modules:{},placeholder:t,readOnly:o,theme:n};let i=Object.assign(l,r.options);i.modules.toolbar={container:E(),handlers:{}},r.withCounter&&(i.modules.counter={container:e});const s=i.modules.toolbar.handlers;return r.customImageHandler&&(s.image=()=>{u.value.click()}),Object.keys(r.toolbarHandlers).forEach((e=>{s[e]=t=>{r.toolbarHandlers[e](m.$editor,t)}})),i}(0,n.onMounted)((()=>{(0,n.nextTick)((async()=>{const{toolbarTips:e,toolbarOptions:t,emotions:n,extension:l}=r;m.$editor=await function(e,t){let{toolbarIcons:n,toolbarTips:l,toolbarOptions:i,options:r,emotions:a,extension:c}=t;const d=o(76095),u=r.modules.toolbar.handlers;s({Quill:d,toolbarHandlers:u}),D.forEach((e=>{r.modules[e]=!0})),B(i),Q(n),G(),"snow"===r.theme&&T(a),c&&d.register(c,!0);const m=new d(e,r);return s({quill:m}),m.insert=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=m.getSelection(!0);o&&(m.insertEmbed(o.index,e,t,d.sources.USER),m.setSelection(o.index+1,d.sources.SILENT))},R(l),m}(c.value,{toolbarIcons:Object.assign(X.toolbarIcons,r.toolbarIcons),toolbarTips:e,toolbarOptions:t,options:y(d.value),emotions:n,extension:l}),r.modelValue&&q(r.modelValue),m.$editor.on("text-change",((e,t,o)=>{let n=v();n===X.BLANK&&(n=""),m.htmlContent=n,i(X.EVENTS.TEXT_CHANGE,n)}))})),(0,n.watch)((()=>r.modelValue),(e=>{e?m.htmlContent!==e&&(q(e),m.$editor.blur()):q("")})),document.addEventListener("click",C)})),(0,n.onBeforeUnmount)((()=>{g.clear(),document.removeEventListener("click",C)}));const v=()=>m.$editor.root.innerHTML,q=e=>m.$editor.root.innerHTML=e,j=e=>m.$editor.insert("image",e);function _(e){(0,K.Z)(r,e,(e=>{i(X.EVENTS.FILE_CHANGE,e[0],j)}))}return l({useEditor:a,encodeEmoji:e=>g.encode(e),decodeEmoji:e=>g.decode(e)}),(t,o)=>((0,n.openBlock)(),(0,n.createElementBlock)("div",{class:(0,n.normalizeClass)((0,n.unref)(h))},[(0,n.renderSlot)(t.$slots,"toolbar"),(0,n.createElementVNode)("div",J,[(0,n.unref)(f)?((0,n.openBlock)(),(0,n.createElementBlock)("pre",Y,(0,n.toDisplayString)((0,n.unref)(p)),1)):((0,n.openBlock)(),(0,n.createElementBlock)("div",{key:1,ref_key:"editor",ref:c,class:"mdc-editor-quill"},null,512))]),e.withCounter?((0,n.openBlock)(),(0,n.createElementBlock)("div",{key:0,ref_key:"counter",ref:d,class:"mdc-editor__counter"},null,512)):(0,n.createCommentVNode)("",!0),e.customImageHandler?((0,n.openBlock)(),(0,n.createElementBlock)("input",{key:1,ref_key:"file",ref:u,type:"file",hidden:"",onChange:_},null,544)):(0,n.createCommentVNode)("",!0),(0,n.renderSlot)(t.$slots,"default")],2))}})},93590:function(e,t){const o={ERROR:{NON_IMAGE:1,NOT_PREVIEWABLE:2},tmpFileId(){const e=window.crypto||window.msCrypto;let t=new Uint32Array(8);e.getRandomValues(t);let o="";for(let n=0,l=t.length;n<l;n++)o+=(n<2||n>5?"":"-")+t[n].toString(16).slice(-4);return o},createFileObject(e){let{lastModified:t,name:n,size:l,type:i}=e;return{tmpId:o.tmpFileId(),lastModified:t,name:n,size:l,type:i,sourceFile:e}},getPreviewSrc(e){return new Promise(((t,n)=>{if(e.type.startsWith("image/"))if(window.URL)t(window.URL.createObjectURL(e.sourceFile));else if(window.FileReader){let o=new FileReader;o.onload=function(e){t(e.target.result)},o.readAsDataURL(e.sourceFile)}else n(o.ERROR.NOT_PREVIEWABLE);else n(o.ERROR.NON_IMAGE)}))},async handlePreview(e){e.previewSrc="",e.previewError=0;try{e.previewSrc=await o.getPreviewSrc(e)}catch(t){e.previewError=t}}};t.Z=async function(e,t,n){const l=[].slice.call(t.target.files);if(l.length){n(await Promise.all(l.map((async t=>{const n=o.createFileObject(t);return e.preview&&await o.handlePreview(n),Promise.resolve(n)})))),t.target.value=""}}}}]);